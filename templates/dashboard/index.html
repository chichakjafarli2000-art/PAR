<!DOCTYPE html>
<html lang="az">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Credit Dashboard 2024â€“2026</title>
<script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.1/dist/chart.umd.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/chartjs-plugin-datalabels@2.2.0/dist/chartjs-plugin-datalabels.min.js"></script>
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
<style>
@import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap');
:root {
  --bg:#070d14; --card:#0d1823; --border:rgba(255,255,255,0.07);
  --muted:#5a7a96; --text:#e2eaf4;
}
*{box-sizing:border-box;}
body{font-family:'Inter',sans-serif;background:var(--bg);color:var(--text);min-height:100vh;
  background-image:radial-gradient(ellipse 80% 35% at 50% -5%,rgba(59,130,246,0.13) 0%,transparent 65%);}

.dash-header{text-align:center;padding:24px 0 16px;}
.badge-top{display:inline-block;background:rgba(59,130,246,0.12);border:1px solid rgba(59,130,246,0.25);
  border-radius:20px;padding:4px 18px;font-size:0.7rem;font-weight:600;letter-spacing:2px;
  text-transform:uppercase;color:#60a5fa;margin-bottom:10px;}
.dash-header h1{font-size:1.8rem;font-weight:800;letter-spacing:2px;
  background:linear-gradient(135deg,#fff 0%,#60a5fa 55%,#a78bfa 100%);
  -webkit-background-clip:text;-webkit-text-fill-color:transparent;background-clip:text;margin-bottom:4px;}
.dash-header p{color:var(--muted);font-size:0.82rem;}

.g-card{background:var(--card);border:1px solid var(--border);border-radius:16px;padding:18px 22px;}
.filter-label{font-size:0.67rem;text-transform:uppercase;letter-spacing:1.5px;color:var(--muted);margin-bottom:6px;display:block;}

.form-select,.form-select:focus{background-color:#111e2c!important;color:var(--text)!important;
  border-color:rgba(255,255,255,0.12)!important;box-shadow:none!important;font-size:0.84rem;}
.form-select option{background:#111e2c;}

.tog-row{display:flex;gap:8px;flex-wrap:wrap;}
.tog-btn{padding:6px 16px;border-radius:20px;border:1px solid rgba(255,255,255,0.12);
  background:transparent;color:var(--muted);font-size:0.8rem;font-weight:500;cursor:pointer;transition:all .18s;}
.tog-btn:hover{background:rgba(255,255,255,0.06);color:var(--text);}
.tog-btn.active{background:rgba(59,130,246,0.18);border-color:rgba(59,130,246,0.45);color:#60a5fa;font-weight:600;}
.tog-btn.b-630.active{background:rgba(20,184,166,0.15);border-color:rgba(20,184,166,0.4);color:#2dd4bf;}
.tog-btn.b-3190.active{background:rgba(249,115,22,0.15);border-color:rgba(249,115,22,0.4);color:#fb923c;}
.tog-btn.b-90p.active{background:rgba(239,68,68,0.15);border-color:rgba(239,68,68,0.4);color:#f87171;}

.year-btn{padding:5px 14px;border-radius:16px;border:1px solid rgba(255,255,255,0.12);
  background:transparent;color:var(--muted);font-size:0.78rem;font-weight:500;cursor:pointer;transition:all .18s;}
.year-btn:hover{background:rgba(255,255,255,0.06);color:var(--text);}
.year-btn.active{background:rgba(139,92,246,0.18);border-color:rgba(139,92,246,0.45);color:#a78bfa;font-weight:600;}

.range-wrap{display:flex;align-items:center;gap:10px;flex-wrap:wrap;}
.range-select{background:#111e2c!important;color:var(--text)!important;
  border:1px solid rgba(255,255,255,0.12)!important;border-radius:10px;
  padding:5px 10px;font-size:0.8rem;cursor:pointer;outline:none;}
.range-select:focus{border-color:rgba(139,92,246,0.4)!important;}
.range-select option{background:#111e2c;}
.range-sep{color:var(--muted);font-size:0.8rem;font-weight:500;}

.filter-divider{border:none;border-top:1px solid var(--border);margin:14px 0;}

.section-title{font-size:0.72rem;text-transform:uppercase;letter-spacing:1.5px;color:var(--muted);
  display:flex;align-items:center;gap:7px;margin-bottom:14px;}
.s-dot{width:8px;height:8px;border-radius:50%;display:inline-block;}

.leg-row{display:flex;gap:10px;flex-wrap:wrap;margin-bottom:14px;}
.leg-btn{display:flex;align-items:center;gap:7px;padding:6px 16px;border-radius:20px;
  border:2px solid;background:transparent;font-size:0.78rem;font-weight:600;
  cursor:pointer;transition:all .2s;letter-spacing:0.3px;}
.leg-btn.lb-port{border-color:#4a7fa5;color:#7ab8d8;}
.leg-btn.lb-port.active{background:rgba(30,58,95,0.4);box-shadow:0 0 10px rgba(30,58,95,0.6);}
.leg-btn.lb-rec{border-color:#22c55e;color:#4ade80;}
.leg-btn.lb-rec.active{background:rgba(34,197,94,0.15);box-shadow:0 0 10px rgba(34,197,94,0.3);}
.leg-btn.lb-npl{border-color:#f97316;color:#fb923c;}
.leg-btn.lb-npl.active{background:rgba(249,115,22,0.15);box-shadow:0 0 10px rgba(249,115,22,0.3);}
.leg-btn.lb-inf{border-color:#38bdf8;color:#7dd3fc;}
.leg-btn.lb-inf.active{background:rgba(56,189,248,0.15);box-shadow:0 0 10px rgba(56,189,248,0.3);}
.leg-btn.off{opacity:0.25;box-shadow:none!important;}
.leg-dot{width:9px;height:9px;border-radius:50%;flex-shrink:0;}

.chart-main{height:540px;}
.chart-wrap{position:relative;}

.spinner-wrap{display:none;position:absolute;inset:0;background:rgba(7,13,20,.7);
  align-items:center;justify-content:center;border-radius:16px;z-index:10;}
.spinner-wrap.show{display:flex;}
.spinner{width:34px;height:34px;border:3px solid rgba(59,130,246,.2);border-top-color:#3b82f6;
  border-radius:50%;animation:spin .8s linear infinite;}
@keyframes spin{to{transform:rotate(360deg);}}

.date-tag{display:inline-flex;align-items:center;gap:5px;padding:3px 10px;border-radius:12px;
  background:rgba(139,92,246,0.12);border:1px solid rgba(139,92,246,0.25);
  font-size:0.72rem;font-weight:600;color:#a78bfa;}
</style>
</head>
<body>

<div class="dash-header">
  <div class="badge-top">PAR Portfolio Analysis</div>
  <h1>CREDIT DASHBOARD 2024â€“2026</h1>
  <p>PSD Â· Micro Â· KOS â€” Portfolio Trend, Recovery and Inflow</p>
</div>

<div class="container-fluid px-4 pb-5">

  <div class="g-card mb-4">
    <div class="row g-3 align-items-end mb-2">
      <div class="col-md-3">
        <span class="filter-label">Portfolio Type</span>
        <div class="tog-row" id="sheetBtns">
          {% for s in sheets %}
          <button class="tog-btn {% if s == selected_sheet %}active{% endif %}"
                  onclick="selectSheet('{{ s }}', this)">{{ s }}</button>
          {% endfor %}
        </div>
      </div>
      <div class="col-md-4">
        <span class="filter-label">PAR Bucket</span>
        <div class="tog-row" id="bucketBtns">
          <button class="tog-btn {% if selected_bucket == '1-5' %}active{% endif %}"
                  onclick="selectBucket('1-5', this)">1-5</button>
          <button class="tog-btn b-630 {% if selected_bucket == '6-30' %}active{% endif %}"
                  onclick="selectBucket('6-30', this)">6-30</button>
          <button class="tog-btn b-3190 {% if selected_bucket == '31-90' %}active{% endif %}"
                  onclick="selectBucket('31-90', this)">31-90</button>
          <button class="tog-btn b-90p {% if selected_bucket == '90+' %}active{% endif %}"
                  onclick="selectBucket('90+', this)">90+</button>
        </div>
      </div>
      <div class="col-md-4">
        <span class="filter-label">Product</span>
        <select id="mehsulSelect" class="form-select" onchange="loadChart()">
          {% for m in mehsullar %}
          <option value="{{ m }}" {% if m == selected_mehsul %}selected{% endif %}>{{ m }}</option>
          {% endfor %}
        </select>
      </div>
    </div>

    <hr class="filter-divider">

    <div class="row g-3 align-items-end">
      <div class="col-md-5">
        <span class="filter-label">ðŸ“… Year Range</span>
        <div class="range-wrap">
          <select id="yearFrom" class="range-select" onchange="loadChart()">
            {% for y in all_years %}
            <option value="{{ y }}" {% if y == year_from %}selected{% endif %}>{{ y }}</option>
            {% endfor %}
          </select>
          <span class="range-sep">â†’</span>
          <select id="yearTo" class="range-select" onchange="loadChart()">
            {% for y in all_years %}
            <option value="{{ y }}" {% if y == year_to %}selected{% endif %}>{{ y }}</option>
            {% endfor %}
          </select>
        </div>
      </div>
      <div class="col-md-4">
        <span class="filter-label">ðŸ“† Month Range</span>
        <div class="range-wrap">
          <select id="monthFrom" class="range-select" onchange="loadChart()">
            {% for num, name in months_az.items %}
            <option value="{{ num }}" {% if num == month_from %}selected{% endif %}>{{ name }}</option>
            {% endfor %}
          </select>
          <span class="range-sep">â†’</span>
          <select id="monthTo" class="range-select" onchange="loadChart()">
            {% for num, name in months_az.items %}
            <option value="{{ num }}" {% if num == month_to %}selected{% endif %}>{{ name }}</option>
            {% endfor %}
          </select>
        </div>
      </div>
      <div class="col-md-3">
        <span class="filter-label">Selected Range</span>
        <div class="date-tag" id="dateTag">All years</div>
      </div>
    </div>
  </div>

  <div class="g-card mb-4" style="position:relative;">
    <div class="spinner-wrap" id="spinner1"><div class="spinner"></div></div>
    <div class="section-title">
      <span class="s-dot" style="background:#4a7fa5;box-shadow:0 0 6px #4a7fa5"></span>
      Portfolio Volume and NPL Ratios
    </div>
    <div class="leg-row">
      <button class="leg-btn lb-port active" onclick="toggleDS(0,this)">
        <span class="leg-dot" style="background:#2d5f8a"></span><span>Portfolio 1-5</span>
      </button>
      <button class="leg-btn lb-rec active" onclick="toggleDS(1,this)">
        <span class="leg-dot" style="background:#22c55e"></span><span>Recovery PAR 1-5</span>
      </button>
      <button class="leg-btn lb-npl active" onclick="toggleDS(2,this)">
        <span class="leg-dot" style="background:#f97316"></span><span>Towards to NPL</span>
      </button>
      <button class="leg-btn lb-inf active" onclick="toggleDS(3,this)">
        <span class="leg-dot" style="background:#38bdf8"></span><span>Inflow</span>
      </button>
    </div>
    <div class="chart-wrap chart-main">
      <canvas id="comboChart"></canvas>
    </div>
  </div>

</div>

<script>
Chart.register(ChartDataLabels);

let currentSheet  = '{{ selected_sheet }}';
let currentBucket = '{{ selected_bucket }}';
let currentMehsul = '{{ selected_mehsul }}';
let comboChart;
let chartData = {{ chart_data_json|safe }};

const MONTHS_AZ = {1:'Jan',2:'Feb',3:'Mar',4:'Apr',5:'May',6:'Jun',7:'Jul',8:'Aug',9:'Sep',10:'Oct',11:'Nov',12:'Dec'};

const BUCKET_COLORS = {
  '1-5':   {bar:'rgba(28,65,110,0.9)',  barB:'#3a7fc1', peak:'rgba(15,35,75,0.98)',  peakB:'#93c5fd', lbl:'#93c5fd'},
  '6-30':  {bar:'rgba(28,65,110,0.9)',  barB:'#3a7fc1', peak:'rgba(15,35,75,0.98)',  peakB:'#93c5fd', lbl:'#93c5fd'},
  '31-90': {bar:'rgba(28,65,110,0.9)',  barB:'#3a7fc1', peak:'rgba(15,35,75,0.98)',  peakB:'#93c5fd', lbl:'#93c5fd'},
  '90+':   {bar:'rgba(28,65,110,0.9)',  barB:'#3a7fc1', peak:'rgba(15,35,75,0.98)',  peakB:'#93c5fd', lbl:'#93c5fd'},
};

// â”€â”€ Ä°L SEÃ‡Ä°MÄ° (range) â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

// â”€â”€ SHEET / BUCKET â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function selectSheet(sheet, btn) {
  currentSheet = sheet;
  document.querySelectorAll('#sheetBtns .tog-btn').forEach(b => b.classList.remove('active'));
  btn.classList.add('active');
  showSpinner(true);
  fetch(`/api/mehsullar/?sheet=${sheet}`)
    .then(r => r.json())
    .then(j => {
      const sel = document.getElementById('mehsulSelect');
      sel.innerHTML = '';
      j.mehsullar.forEach(m => {
        const o = document.createElement('option');
        o.value = m; o.textContent = m;
        sel.appendChild(o);
      });
      currentMehsul = j.mehsullar[0] || '';
      loadChart();
    });
}

function selectBucket(bucket, btn) {
  currentBucket = bucket;
  document.querySelectorAll('#bucketBtns .tog-btn').forEach(b => b.classList.remove('active'));
  btn.classList.add('active');
  document.querySelector('.leg-btn.lb-port span:last-child').textContent = `Portfolio ${bucket}`;
  document.querySelector('.leg-btn.lb-rec span:last-child').textContent  = `Recovery PAR ${bucket}`;
  const nplBtn = document.querySelector('.leg-btn.lb-npl');
  nplBtn.style.display = bucket === '90+' ? 'none' : 'flex';
  
  // Legend dÃ¼ymÉ™lÉ™rini hamÄ±sÄ±nÄ± aktiv et
  document.querySelectorAll('.leg-btn').forEach(b => {
    b.classList.add('active');
    b.classList.remove('off');
  });
  
  loadChart();
}

// â”€â”€ DATE TAG â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function updateDateTag() {
  const yf = document.getElementById('yearFrom').value;
  const yt = document.getElementById('yearTo').value;
  const mf = parseInt(document.getElementById('monthFrom').value);
  const mt = parseInt(document.getElementById('monthTo').value);
  if (yf === yt && mf === 1 && mt === 12) {
    document.getElementById('dateTag').textContent = `${yf}`;
  } else if (mf === 1 && mt === 12) {
    document.getElementById('dateTag').textContent = `${yf} â†’ ${yt}`;
  } else {
    document.getElementById('dateTag').textContent = `${MONTHS_AZ[mf]} ${yf} â†’ ${MONTHS_AZ[mt]} ${yt}`;
  }
}

// â”€â”€ DATA YÃœKLÆ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function loadChart() {
  currentMehsul = document.getElementById('mehsulSelect').value;
  const mf = document.getElementById('monthFrom').value;
  const mt = document.getElementById('monthTo').value;
  updateDateTag();
  showSpinner(true);

  const yFrom = document.getElementById('yearFrom').value;
  const yTo   = document.getElementById('yearTo').value;

  const params = new URLSearchParams({
    sheet: currentSheet, mehsul: currentMehsul, bucket: currentBucket,
    year_from: yFrom, year_to: yTo, month_from: mf, month_to: mt
  });

  fetch(`/api/data/?${params}`)
    .then(r => r.json())
    .then(data => {
      chartData = data;
      drawCombo(data);
      showSpinner(false);
    });
}

function showSpinner(v) {
  document.getElementById('spinner1').classList.toggle('show', v);
}

// â”€â”€ COMBO CHART â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function drawCombo(data) {
  if (comboChart) comboChart.destroy();
  const ctx    = document.getElementById('comboChart').getContext('2d');
  const maxP   = Math.max(...data.portfolio);
  const colors = BUCKET_COLORS[currentBucket];
  
  // Chart yenilÉ™nÉ™ndÉ™ legend dÃ¼ymÉ™lÉ™rini aktiv vÉ™ziyyÉ™tÉ™ gÉ™tir
  setTimeout(() => {
    document.querySelectorAll('.leg-btn').forEach(b => {
      if (!b.classList.contains('off')) {
        b.classList.add('active');
      }
    });
  }, 50);
  const n      = data.portfolio.length;


  // HÉ™r nÃ¶qtÉ™ Ã¼Ã§Ã¼n label mÃ¶vqeyi â€” dÉ™yÉ™rlÉ™rÉ™ gÃ¶rÉ™ dinamik
  // Recovery hÉ™miÅŸÉ™ TOP, NPL hÉ™miÅŸÉ™ BOTTOM, Inflow dÉ™yÉ™rÉ™ gÃ¶rÉ™
  const recPos = (i) => 'top';
  const nplPos = (i) => 'bottom';
  // Inflow: Recovery ilÉ™ mÃ¼qayisÉ™yÉ™ gÃ¶rÉ™
  const infPos = (i) => {
    const rec = data.recovery[i] || 0;
    const inf = data.inflow[i]   || 0;
    // ÆgÉ™r inflow recovery-dÉ™n bÃ¶yÃ¼kdÃ¼rsÉ™ â€” yuxarÄ±, kiÃ§iksÉ™ â€” aÅŸaÄŸÄ±
    return inf >= rec ? 'top' : 'bottom';
  };

  comboChart = new Chart(ctx, {
    data: {
      labels: data.aylar,
      datasets: [
        {
          type:'bar', label:`Portfolio ${currentBucket}`, data:data.portfolio,
          backgroundColor: data.portfolio.map(v => v===maxP ? colors.peak : colors.bar),
          borderColor:     data.portfolio.map(v => v===maxP ? colors.peakB : colors.barB),
          borderWidth:1, borderRadius:5, borderSkipped:false, yAxisID:'yL', order:3,
          datalabels:{
            anchor:'end', align:'top',
            color: ctx => ctx.raw===maxP ? '#ffffff' : '#93c5fd',
            font:{size:15,weight:'800'},
            formatter: v => {
              if (!v || v <= 0) return '';
              if (v >= 1000) return (v/1000).toFixed(1).replace(/\.0$/,'') + 'M';
              return Number(v.toFixed(0)).toLocaleString('en-US') + 'K';
            },
            offset:6,
            clip:false,
          }
        },
        {
          type:'line', label:`Recovery PAR ${currentBucket}`, data:data.recovery,
          borderColor:'#22c55e', backgroundColor:'transparent',
          pointBackgroundColor:'#22c55e', pointBorderColor:'#070d14', pointBorderWidth:2,
          pointRadius:4, pointHoverRadius:7, tension:0.38, borderWidth:2.5, yAxisID:'yR', order:2,
          datalabels:{
            align:'left', anchor:'center',
            color:'#4ade80', font:{size:13,weight:'700'},
            formatter: v => v>0 ? v.toFixed(1)+'%' : '',
            offset:18,
            backgroundColor:'rgba(2,18,6,0.92)',
            borderRadius:4, padding:{top:3,bottom:3,left:6,right:6},
            clip:false,
          }
        },
        {
          type:'line', label:'Towards to NPL',
          data: currentBucket === '90+' ? data.towards_npl.map(() => null) : data.towards_npl,
          hidden: currentBucket === '90+',
          borderColor:'#f97316', backgroundColor:'transparent',
          pointBackgroundColor:'#f97316', pointBorderColor:'#070d14', pointBorderWidth:2,
          pointRadius:4, pointHoverRadius:7, tension:0.38, borderDash:[5,3], borderWidth:2,
          yAxisID:'yR', order:1,
          datalabels:{
            align:'bottom', anchor:'start',
            color:'#fb923c', font:{size:13,weight:'700'},
            formatter: v => v && v>0 ? v.toFixed(1)+'%' : '',
            offset:18,
            backgroundColor:'rgba(22,6,0,0.92)',
            borderRadius:4, padding:{top:3,bottom:3,left:6,right:6},
            clip:false,
          }
        },
        {
          type:'line', label:'Inflow', data:data.inflow,
          borderColor:'#38bdf8', backgroundColor:'transparent',
          pointBackgroundColor:'#38bdf8', pointBorderColor:'#070d14', pointBorderWidth:2,
          pointRadius: data.inflow.map(v => v>100 ? 7 : 4),
          pointHoverRadius:8, tension:0.38, borderWidth:2.5, yAxisID:'yR', order:0,
          datalabels:{
            align:'right', anchor:'center',
            color:'#7dd3fc', font:{size:13,weight:'700'},
            formatter: v => v>0 ? v.toFixed(1)+'%' : '',
            offset:18,
            backgroundColor:'rgba(0,12,22,0.92)',
            borderRadius:4, padding:{top:3,bottom:3,left:6,right:6},
            clip:false,
          }
        }
      ]
    },
    options:{
      responsive:true, maintainAspectRatio:false,
      layout:{padding:{top:60, bottom:25, left:25, right:50}},
      interaction:{mode:'index', intersect:false},
      plugins:{
        legend:{display:false}, datalabels:{},
        tooltip:{
          backgroundColor:'#0d1823', borderColor:'rgba(255,255,255,0.08)', borderWidth:1,
          titleColor:'#e2eaf4', bodyColor:'#8aabb8', padding:13, cornerRadius:10,
          callbacks:{
            title: i => `ðŸ“… ${data.aylar[i[0].dataIndex]}  Â·  PAR ${currentBucket}`,
            label: ctx => ctx.datasetIndex===0
              ? (() => { const v = ctx.raw; const s = v>=1000 ? (v/1000).toFixed(1).replace(/\.0$/,'')+'M' : Number(v.toFixed(0)).toLocaleString('en-US')+'K'; return `  ðŸ“Š ${ctx.dataset.label}: ${s}`; })()
              : `  ${ctx.dataset.label}: ${ctx.raw != null ? ctx.raw.toFixed(1) : '-'}%`
          }
        }
      },
      scales:{
        yL:{
          position:'left',
          grid:{color:'rgba(255,255,255,0.04)'},
          ticks:{color:'#93c5fd', font:{size:14}, callback: v => {
            if (v >= 1000) return (v/1000).toFixed(1).replace(/\.0$/,'') + 'M';
            return Number(v).toLocaleString('en-US') + 'K';
          }},
          border:{color:'rgba(59,130,246,0.15)'}
        },
        yR:{
          position:'right',
          grid:{drawOnChartArea:false},
          ticks:{color:'#a0bcd0', font:{size:14}, callback:v=>v+'%'},
          border:{color:'rgba(255,255,255,0.05)'}
        },
        x:{
          grid:{color:'rgba(255,255,255,0.03)'},
          ticks:{
            color:'#b0cce0',
            font:{size:14},
            maxRotation:45,
            minRotation:45,
            autoSkip:false,
          }
        }
      }
    }
  });
}

// â”€â”€ TOGGLE â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function toggleDS(idx, btn) {
  if (!comboChart) return;
  comboChart.data.datasets[idx].hidden = !comboChart.data.datasets[idx].hidden;
  btn.classList.toggle('off');
  comboChart.update();
}

// Initial render
drawCombo(chartData);
updateDateTag();
document.querySelector('.leg-btn.lb-rec span:last-child').textContent = `Recovery PAR ${currentBucket}`;
if (currentBucket === '90+') {
  document.querySelector('.leg-btn.lb-npl').style.display = 'none';
}
</script>
</body>
</html>